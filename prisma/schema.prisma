generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model comments {
  id        String   @id
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime
  userId    String
  recipeId  String
  recipes   recipes  @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ratings {
  id        String   @id
  value     Int      @db.SmallInt
  createdAt DateTime @default(now())
  updatedAt DateTime
  userId    String
  recipeId  String
  comment   String?
  recipes   recipes  @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, recipeId])
}

model recipes {
  id                                String          @id
  title                             String
  description                       String
  instructions                      String[]
  servings                          Int
  difficulty                        DifficultyLevel
  mainIngredient                    String
  imageUrl                          String?
  status                            RecipeStatus    @default(PENDING)
  rejectionReason                   String?
  averageRating                     Float           @default(0)
  totalRatings                      Int             @default(0)
  createdAt                         DateTime        @default(now())
  updatedAt                         DateTime
  authorId                          String
  adminNote                         String?
  approvedAt                        DateTime?
  approvedById                      String?
  cookingTime                       Int
  dietaryInfo                       Json?
  nutritionInfo                     Json?
  rejectedAt                        DateTime?
  rejectedById                      String?
  tags                              String[]
  ingredients                       Json
  cuisineType                       String?
  prepTime                          Int             @default(10)
  allergies                         String[]
  mealType                          MealType[]      @default([DINNER])
  comments                          comments[]
  ratings                           ratings[]
  users_recipes_approvedByIdTousers users?          @relation("recipes_approvedByIdTousers", fields: [approvedById], references: [id])
  users_recipes_authorIdTousers     users           @relation("recipes_authorIdTousers", fields: [authorId], references: [id], onDelete: Cascade)
  users_recipes_rejectedByIdTousers users?          @relation("recipes_rejectedByIdTousers", fields: [rejectedById], references: [id])

  @@index([authorId])
  @@index([mainIngredient])
  @@index([mealType])
  @@index([status])
}

model sessions {
  id        String   @id
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                                  String     @id
  email                               String     @unique
  password                            String?
  firstName                           String
  lastName                            String
  role                                UserRole   @default(USER)
  isEmailVerified                     Boolean    @default(false)
  termsAccepted                       Boolean    @default(false)
  failedLoginAttempts                 Int        @default(0)
  blockedUntil                        DateTime?
  resetToken                          String?
  resetTokenExpiresAt                 DateTime?
  googleId                            String?    @unique
  oauthProvider                       String?
  createdAt                           DateTime   @default(now())
  updatedAt                           DateTime
  emailVerificationToken              String?
  emailVerificationTokenExpiresAt     DateTime?
  termsAcceptedAt                     DateTime?
  comments                            comments[]
  ratings                             ratings[]
  recipes_recipes_approvedByIdTousers recipes[]  @relation("recipes_approvedByIdTousers")
  recipes_recipes_authorIdTousers     recipes[]  @relation("recipes_authorIdTousers")
  recipes_recipes_rejectedByIdTousers recipes[]  @relation("recipes_rejectedByIdTousers")
  sessions                            sessions[]
}

enum CuisineType {
  ITALIAN
  CHINESE
  MEXICAN
  INDIAN
  JAPANESE
  MEDITERRANEAN
  AMERICAN
  FRENCH
  THAI
  OTHER
}

enum DietType {
  NONE
  VEGETARIAN
  VEGAN
  GLUTEN_FREE
  KETO
  PALEO
  LOW_CARB
  DAIRY_FREE
}

enum DifficultyLevel {
  EASY
  MEDIUM
  HARD
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
  DESSERT
}

enum RecipeStatus {
  PENDING
  APPROVED
  REJECTED
}

enum UserRole {
  USER
  CHEF
  ADMIN
}
